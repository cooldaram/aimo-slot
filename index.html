<!doctype html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>슬롯머신 인터랙션</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Arial", sans-serif;
                background-color: #121212;
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                color: #fff;
            }

            .container {
                display: flex;
                flex-direction: column;
                align-items: center;
                position: relative;
                z-index: 10;
            }

            .slot-machine {
                display: flex;
                gap: 20px;
                margin-bottom: 30px;
                position: relative;
            }

            .slot {
                width: 200px;
                height: 60px;
                background-color: transparent;
                border-radius: 30px;
                position: relative;
                overflow: hidden;
                z-index: 3;
            }

            .reel-container {
                position: absolute;
                width: 100%;
                height: 500%;
                top: 0;
                left: 0;
                transition-timing-function: cubic-bezier(
                    0.17,
                    0.67,
                    0.83,
                    0.67
                );
            }

            .tag {
                width: 100%;
                height: 60px;
                background-color: rgba(18, 18, 18, 0.85);
                border: 1px solid rgba(255, 255, 255, 0.3);
                border-radius: 30px;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 15px;
                font-weight: 300;
                color: white;
                padding: 0 15px;
                letter-spacing: 0.5px;
                margin-bottom: 15px;
                transition: all 0.3s ease;
                backdrop-filter: blur(5px);
                -webkit-backdrop-filter: blur(5px);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }

            /* 연결 라인 스타일 */
            .connection-line {
                position: absolute;
                height: 1px;
                background-color: rgba(255, 255, 255, 0.3);
                top: 50%;
                transform: translateY(-50%);
                z-index: 1;
                opacity: 0;
                transition:
                    opacity 0.5s ease-in-out,
                    width 1.5s ease-in-out;
            }

            /* 최종 결과 스타일 (A, I, M, O) */
            .tag.final {
                border-color: rgba(255, 255, 255, 0.4);
                font-size: 18px;
                font-weight: 400;
            }

            /* 이모지 스타일 */
            .emoji {
                margin-right: 8px;
                font-size: 16px;
            }

            canvas {
                position: fixed;
                z-index: -1;
                top: 0;
                left: 0;
            }
        </style>
    </head>
    <body>
        <canvas id="canvas"></canvas>

        <div class="container">
            <div class="slot-machine">
                <!-- 연결 라인 요소 -->
                <div class="connection-line" id="connectionLine"></div>

                <div class="slot" id="slot1">
                    <div class="reel-container">
                        <div class="tag">
                            <span class="emoji">✈️</span> Telegram
                        </div>
                        <div class="tag">
                            <span class="emoji">🤖</span> Claude
                        </div>
                        <div class="tag">
                            <span class="emoji">💬</span> Slack
                        </div>
                        <div class="tag"><span class="emoji">🐦</span> X</div>
                        <div class="tag final"><span>A</span></div>
                    </div>
                </div>
                <div class="slot" id="slot2">
                    <div class="reel-container">
                        <div class="tag">
                            <span class="emoji">⚙️</span> Auto Trading
                        </div>
                        <div class="tag">
                            <span class="emoji">📡</span> Signal Execution
                        </div>
                        <div class="tag">
                            <span class="emoji">🧭</span> Order Routing
                        </div>
                        <div class="tag">
                            <span class="emoji">🛡️</span> Risk Filter
                        </div>
                        <div class="tag final"><span>I</span></div>
                    </div>
                </div>
                <div class="slot" id="slot3">
                    <div class="reel-container">
                        <div class="tag">
                            <span class="emoji">📊</span> Portfolio Tracker
                        </div>
                        <div class="tag">
                            <span class="emoji">📈</span> PnL Digest
                        </div>
                        <div class="tag">
                            <span class="emoji">🗂️</span> Asset Inventory
                        </div>
                        <div class="tag">
                            <span class="emoji">🧾</span> Dashboard Export
                        </div>
                        <div class="tag final"><span>M</span></div>
                    </div>
                </div>
                <div class="slot" id="slot4">
                    <div class="reel-container">
                        <div class="tag">
                            <span class="emoji">🧠</span> Notion
                        </div>
                        <div class="tag">
                            <span class="emoji">📄</span> Google Sheets
                        </div>
                        <div class="tag">
                            <span class="emoji">✉️</span> Email
                        </div>
                        <div class="tag">
                            <span class="emoji">🤖</span> Cursor
                        </div>
                        <div class="tag final"><span>O</span></div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // 도트 배경 코드
            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext("2d");

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // 마우스 위치 추적
            const mouse = {
                x: undefined,
                y: undefined,
                radius: 150,
            };

            window.addEventListener("mousemove", (event) => {
                mouse.x = event.x;
                mouse.y = event.y;
            });

            window.addEventListener("resize", () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                createPoints();
            });

            // 점 데이터 저장
            let points = [];

            // 점 생성 함수
            function createPoints() {
                points = [];

                const spacing = 40;

                for (let x = spacing; x < canvas.width; x += spacing) {
                    for (let y = spacing; y < canvas.height; y += spacing) {
                        points.push({
                            x: x,
                            y: y,
                            baseSize: 1,
                            size: 1,
                            color: "#333333",
                            baseColor: "#333333",
                            glowColor: "#666666",
                        });
                    }
                }
            }

            // 그리기 함수
            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // 각 점 그리기
                for (let i = 0; i < points.length; i++) {
                    const point = points[i];

                    // 마우스와의 거리 계산
                    if (mouse.x !== undefined && mouse.y !== undefined) {
                        const dx = mouse.x - point.x;
                        const dy = mouse.y - point.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);

                        // 마우스 범위 내에 있으면 빛나는 효과
                        if (distance < mouse.radius) {
                            const effect = 1 - distance / mouse.radius;
                            point.size = point.baseSize + effect * 3;

                            const r = Math.floor(51 + effect * 100);
                            const g = Math.floor(51 + effect * 100);
                            const b = Math.floor(51 + effect * 100);
                            point.color = `rgb(${r}, ${g}, ${b})`;
                        } else {
                            point.size = point.baseSize;
                            point.color = point.baseColor;
                        }
                    }

                    ctx.fillStyle = point.color;
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, point.size, 0, Math.PI * 2);
                    ctx.fill();
                }

                requestAnimationFrame(draw);
            }

            createPoints();
            draw();

            // 슬롯머신 코드
            document.addEventListener("DOMContentLoaded", function () {
                const slots = document.querySelectorAll(".slot");
                const reels = document.querySelectorAll(".reel-container");
                const connectionLine =
                    document.getElementById("connectionLine");
                let isSpinning = false;

                // 초기 위치 설정 (각 릴의 첫 번째 아이템 표시)
                reels.forEach((reel) => {
                    reel.style.transition = "none";
                    reel.style.top = "0px";
                });

                // 연결 라인 위치 계산 및 설정
                function setupConnectionLine() {
                    const firstSlot = slots[0].getBoundingClientRect();
                    const lastSlot =
                        slots[slots.length - 1].getBoundingClientRect();

                    const lineWidth = lastSlot.right - firstSlot.left;
                    connectionLine.style.width = "0";
                    connectionLine.style.left =
                        firstSlot.left - firstSlot.left + "px";

                    return lineWidth;
                }

                // 연결 라인 표시
                function showConnectionLine() {
                    const lineWidth = setupConnectionLine();

                    // 라인 애니메이션 시작
                    setTimeout(() => {
                        connectionLine.style.opacity = "1";
                        connectionLine.style.width = lineWidth + "px";
                    }, 500);
                }

                // 연결 라인 즉시 숨기기
                function hideConnectionLine() {
                    // 트랜지션 효과 제거로 즉시 사라지게 함
                    connectionLine.style.transition = "none";
                    connectionLine.style.opacity = "0";
                    connectionLine.style.width = "0";

                    // 트랜지션 복원 (다음 애니메이션을 위해)
                    setTimeout(() => {
                        connectionLine.style.transition =
                            "opacity 0.5s ease-in-out, width 1.5s ease-in-out";
                    }, 50);
                }

                function spinReels() {
                    if (isSpinning) return;
                    isSpinning = true;

                    // 라인 즉시 숨기기
                    hideConnectionLine();

                    // 각 릴마다 개별적으로 회전
                    reels.forEach((reel, index) => {
                        // 현재 위치 초기화
                        reel.style.transition = "none";
                        reel.style.top = "0px";

                        // 강제 리플로우
                        void reel.offsetHeight;

                        // 회전 속도와 지연 설정 (각 릴마다 다르게)
                        const duration = 3 + index * 0.5; // 초 단위
                        const delay = index * 0.3; // 초 단위

                        // 트랜지션 설정
                        reel.style.transition = `top ${duration}s cubic-bezier(.17,.67,.83,.67) ${delay}s`;

                        // 마지막 아이템이 중앙에 오도록 회전
                        reel.style.top = "-300px";
                    });

                    // 모든 릴이 멈춘 후 연결 라인 표시 및 상태 리셋, 그리고 자동 재시작
                    const maxDuration = 5; // 가장 오래 돌아가는 릴 기준
                    setTimeout(() => {
                        showConnectionLine();

                        // AIMO 결과를 2초간 보여준 후 다시 회전 시작
                        setTimeout(() => {
                            isSpinning = false;
                            spinReels();
                        }, 2000);
                    }, maxDuration * 1000);
                }

                // 윈도우 리사이즈시 연결 라인 위치 재조정
                window.addEventListener("resize", () => {
                    if (!isSpinning && connectionLine.style.opacity === "1") {
                        setupConnectionLine();
                    }
                });

                // 페이지 로드 시 자동 시작
                setTimeout(spinReels, 1000);
            });
        </script>
    </body>
</html>
